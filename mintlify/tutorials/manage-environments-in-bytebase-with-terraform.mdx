---
title: Manage Environments with Terraform
author: Adela
updated_at: 2025/07/15 21:15
tags: Tutorial
integrations: Terraform
category: 'Integration'
featured: true
level: Intermediate
estimated_time: '30 mins'
---

import TerminalDockerRunVolume from '/snippets/install/terminal-docker-run-volume.mdx';

This tutorial is part of the **Bytebase Terraform Provider** series:

- ðŸ‘‰ Part 1: Manage Environments with Terraform - Set up environments with configuration
- Part 2: Manage Databases with Terraform - Set up instances
- Part 3: [Manage Projects with Terraform](/tutorials/manage-projects-in-bytebase-with-terraform) - Organize databases into projects
- Part 4: [Manage Bytebase Settings with Terraform](/tutorials/manage-bytebase-settings-with-terraform) - Configure workspace settings, environment policies, approval flows, and risk management
- Part 5: [Manage SQL Review Rules with Terraform](/tutorials/manage-sql-review-rules-with-terraform) - Set up SQL review policies
- Part 6: [Manage Users and Groups with Terraform](/tutorials/manage-database-access-control-with-terraform) - Set up access controls and permissions
- Part 7: [Manage Database Access Control with Terraform](/tutorials/manage-database-access-control-with-terraform) - Set up access controls and permissions
- Part 8: [Manage Data Masking with Terraform](/tutorials/manage-data-masking-with-terraform) - Configure data masking policies

<Card icon="code-xml" cta="View sample code" href="https://github.com/bytebase/terraform-provider-bytebase/tree/main/tutorials">

This tutorial series uses separate Terraform files for better organization. Files are numbered by tutorial part and sub-step (e.g., `1-1-env.tf`, `1-2-instances.tf` for Part 1, `2-projects.tf` for Part 2, etc.). Terraform automatically handles dependencies between files.

</Card>

## What You'll Learn

- **Set up** Bytebase with Terraform for automated database management
- **Configure** environments using settings with configurations such as rollout policies

## Prerequisites

Before starting this tutorial, ensure you have:

- **Docker**: [Install Docker](https://www.docker.com/) to run Bytebase
- **Terraform**: [Install Terraform](https://www.terraform.io/downloads) for infrastructure as code
- **Bytebase Enterprise Plan** (optional) â€“ Some features require the Enterprise Plan

## Setup

### Install Terraform

Follow the [official Terraform installation guide](https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli).

### Start Bytebase and Prepare Some Data

1. Run Bytebase in [Docker](https://www.docker.com/) with the following command:

   <TerminalDockerRunVolume />

1. Once Bytebase is running in Docker, you can access it at `localhost:8080`.

1. Register an admin account with `Workspace Admin` role.

   ![register-admin](/content/docs/tutorials/manage-databases-in-bytebase-with-terraform/bb-register-admin.webp)

1. Follow the guide to configure, you'll need the **built-in sample** data for this tutorial.

   ![built-in-instance](/content/docs/tutorials/manage-databases-in-bytebase-with-terraform/bb-use-built-in-sample.webp)

1. (Optional) After logging into Bytebase, [activate official or trial license](/administration/license#configure-workspace-license). _Some features require the Enterprise Plan._

   ![subscription](/content/docs/tutorials/manage-databases-in-bytebase-with-terraform/bb-subscription.webp)

### Verify Bytebase Default Environments

Within Bytebase, click **Environments** on the left sidebar. You will see there are two default envrionments with configurations such as rollout polices. You may adjust the setting via GUI.

    ![env-default](/content/docs/tutorials/manage-databases-in-bytebase-with-terraform/bb-env-default.webp)

## Configure Environments via Terraform

### Step 1 - Create Terraform Configuration

1. Create a new folder `learn-terraform-bytebase` and navigate to it.

1. Create `0-provider.tf` for the provider configuration, visit [Terraform Bytebase Provider](https://registry.terraform.io/providers/bytebase/bytebase/latest/docs), click **USE PROVIDER** and copy the configuration.

   ```hcl
   terraform {
     required_providers {
       bytebase = {
         source  = "registry.terraform.io/bytebase/bytebase"
         version = "3.8.2"  # Use the latest stable version
       }
     }
   }
   ```

1. Copy the following provider part and paste it in `0-provider.tf`.

   ```hcl
   provider "bytebase" {
     service_account = "tf@service.bytebase.com"
      service_key Â  Â  = "<Your Bytebase service account key>"
      url Â  Â  Â  Â  Â  Â  = "<Your Bytebase external URL>"
   }
   ```

### Step 2 - Create Service Account

1. In Bytebase, click **IAM & Admin > Users & Groups** on the left sidebar, then click **+ Add User**.

1. Select `Service Account` as the **Type**, enter `tf@service.bytebase.com` as the **Email**, select `Workspace Admin` as **Roles**, and click **Confirm**.

1. Copy the **Service Key** for the next step.

### Step 3 - Initialize and Inspect Resources

1. Update `0-provider.tf` with your **Service Key** and **URL**.

1. Create `1-0-list-env.tf` to inspect existing resources:

   ```hcl
   # List all environments using settings
   data "bytebase_setting" "environments" {
      name = "settings/ENVIRONMENT"
   }
   output "all_environments" {
      value = data.bytebase_setting.environments
   }
   ```

1. Run `terraform init`, `terraform plan` and `terraform apply` one by one in the terminal. Youâ€™ll see:

   - Two environments: `test` and `prod`.

### Step 4 - Configure Environments

1. Create `1-1-env-setting.tf` with the following environment configuration which defines two environments `Test` and `Prod`, while `Prod` is protected.

   ```hcl
   # Environment Settings
   resource "bytebase_setting" "environments" {
     name = "settings/ENVIRONMENT"

     environment_setting {
       environment {
         id        = "test"
         title     = "Test"
         protected = false
       }
       environment {
         id        = "prod"
         title     = "Prod"
         protected = true
       }
     }
   }
   ```

### Step 5 - Configure Environment Policies

To add more settings to the environment configuration, such as rollout policies, create `1-2-env-policy.tf` with the following configuration:

   1. Create `1-2-env-policy.tf` with the following configuration:

   ```hcl

      resource "bytebase_policy" "rollout_policy_test" {
      depends_on = [bytebase_setting.environments]
      parent     = bytebase_setting.environments.environment_setting[0].environment[0].name
      type       = "ROLLOUT_POLICY"

      rollout_policy {
         automatic = true
         roles = [
            "roles/workspaceAdmin",
            "roles/projectOwner",
            "roles/LAST_APPROVER",
            "roles/CREATOR"
         ]
      }
      }

      resource "bytebase_policy" "rollout_policy_prod" {
      depends_on = [bytebase_setting.environments]
      parent     = bytebase_setting.environments.environment_setting[0].environment[1].name
      type       = "ROLLOUT_POLICY"

      rollout_policy {
         automatic = false
         roles = [
            "roles/workspaceAdmin",
            "roles/projectOwner",
            "roles/LAST_APPROVER",
            "roles/CREATOR"
         ]
      }
      }

   ```

   ```hcl

      resource "bytebase_policy" "disable_copy_data_policy_prod" {
      depends_on = [bytebase_setting.environments]
      parent     = bytebase_setting.environments.environment_setting[0].environment[1].name
      type       = "DISABLE_COPY_DATA"

      disable_copy_data_policy {
         enable = true
      }
      }

      resource "bytebase_policy" "data_source_query_policy_prod" {
      depends_on = [bytebase_setting.environments]
      parent     = bytebase_setting.environments.environment_setting[0].environment[1].name
      type       = "DATA_SOURCE_QUERY"

      data_source_query_policy {
         restriction  = "RESTRICTION_UNSPECIFIED" # or DISALLOW or FALLBACK
         disallow_ddl = true
         disallow_dml = true
      }
      }

   ```

**Key Points**:

1. Run `terraform plan` and `terraform apply` one by one in the terminal.

1. Go back to Bytebase, and click **Environments**. The `Prod` will be set as protected with the shield icon.

## Next Steps

Continue the series [Manage Projects with Terraform](/tutorials/manage-projects-in-bytebase-with-terraform) - organize your databases into projects.

**Resources:**

- [Tutorial files](https://github.com/bytebase/terraform-provider-bytebase/tree/main/tutorials)
- [Advanced examples](https://github.com/bytebase/terraform-provider-bytebase/tree/main/examples)
- [Discord community](https://discord.gg/huyw7gRsyA)
